<div class="container-fluid p-4 dashboard-wrapper">
    <!-- Hero -->
    <div class="hero-card mb-4 p-3 rounded">
        <div class="hero-date">{{ fechaActual | date:'MMM d, y h:mm a' }}</div>
        <div class="hero-title">Buenos días {{ usuarioActual }}!</div>
    </div>

    <!-- Stats + Estado de citas -->
    <div class="row g-3 mb-4" *ngIf="stats$ | async as stats">
        <div class="col-lg-3 col-md-6" *ngFor="let card of [
            {label:'Citas del año', num:stats.totalCitasAnio, change:stats.variationYear},
            {label:'Citas del mes', num:stats.totalCitasMes, change:stats.variationMonth},
            {label:'Citas del día', num:stats.totalCitasDia, change:stats.variationDay},
            {label:'Usuarios registrados', num:stats.totalUsuarios, change:null}
        ]">
            <app-card-basic
                [label]="card.label"
                [number]="card.num ?? 0"
                [change]="card.change !== null ? card.change + '%' : ''"
                type="basic">
            </app-card-basic>
        </div>

        <div class="col-lg-3 col-md-6" *ngIf="appointmentStatus$ | async as appt">
            <div class="card h-100 appointment-card">
                <div class="card-body">
                    <div class="stat-label">Estado de Citas</div>
                    <div class="stat-number">{{ appt.total | number }}</div>
                    <div class="status-tabs mt-3">
                        <div class="status-tab tab-scheduled">Programadas {{ appt.scheduled }}</div>
                        <div class="status-tab tab-completed">Completadas {{ appt.completed }}</div>
                        <div class="status-tab tab-canceled">Canceladas {{ appt.canceled }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Comportamiento del año y Staff -->
    <div class="row g-3">
        <!-- Comportamiento del año -->
        <div class="col-lg-6" *ngIf="chartItems$ | async as items">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="mb-3">Comportamiento del año</h5>
                    <div class="table-responsive">
                        <table class="table table-sm align-middle">
                            <thead>
                                <tr>
                                    <th>Mes</th>
                                    <th>Valor</th>
                                    <th>%</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let item of items">
                                    <td>
                                        <span class="legend-color" [style.background]="item.color"></span>
                                        {{ item.label }}
                                    </td>
                                    <td>{{ item.value }}</td>
                                    <td>{{ item.percent }}%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="text-end">
                        <button class="btn btn-danger btn-sm" (click)="exportarYearBehavior(items)">Exportar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Staff -->
        <div class="col-lg-6" *ngIf="staff$ | async as staff">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="mb-4">Nuestro personal</h5>
                    <div class="row g-3">
                        <div class="col-md-4" *ngFor="let member of staff">
                            <div class="staff-card text-center p-3 rounded" [style.background]="member.color">
                                <div class="staff-avatar mx-auto mb-2" [style.background]="member.color">
                                    {{ member.fullName | slice:0:2 | uppercase }}
                                </div>
                                <div class="status-indicator" [ngClass]="member.status"></div>
                                <h6>{{ member.fullName }}</h6>
                                <small class="text-muted">{{ member.specialty }}</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div> 
</div>
