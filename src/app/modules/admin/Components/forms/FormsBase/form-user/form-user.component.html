<!-- form-usuario.component.html -->
<div class="modal-overlay">
  <div class="modal-container">
    <div class="modal-header">
      <h2 class="modal-title">{{ currentStep === 1 ? 'Registrar Persona' : 'Registrar Usuario' }}</h2>
      <div class="icon-container">
        <svg viewBox="0 0 24 24" class="role-icon">
          <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
        </svg>
        <svg viewBox="0 0 24 24" class="link-icon">
          <path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/>
        </svg>
      </div>
      
      <!-- Progress indicator -->
      <div class="progress-container">
        <div class="progress-step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">
          <span>1</span>
        </div>
        <div class="progress-line" [class.completed]="currentStep > 1"></div>
        <div class="progress-step" [class.active]="currentStep >= 2">
          <span>2</span>
        </div>
      </div>
    </div>

    <!-- Paso 1: Formulario de Persona -->
    <form *ngIf="currentStep === 1" [formGroup]="personaForm" (ngSubmit)="onSubmitPersona()" class="role-form">
      
      <!-- Nombres -->
      <div class="form-group">
        <label for="fullName" class="form-label">Nombres</label>
        <input
          type="text"
          id="fullName"
          formControlName="fullName"
          class="form-input"
          [class.error]="getFieldError('fullName')"
          placeholder="Ingresa los nombres completos"
        >
        <div class="error-message" *ngIf="getFieldError('fullName')">
          {{ getFieldError('fullName') }}
        </div>
      </div>

      <!-- Apellidos -->
      <div class="form-group">
        <label for="fullLastName" class="form-label">Apellidos</label>
        <input
          type="text"
          id="fullLastName"
          formControlName="fullLastName"
          class="form-input"
          [class.error]="getFieldError('fullLastName')"
          placeholder="Ingresa los apellidos completos"
        >
        <div class="error-message" *ngIf="getFieldError('fullLastName')">
          {{ getFieldError('fullLastName') }}
        </div>
      </div>

      <!-- Tipo de documento y documento en fila -->
      <div class="form-row">
        <div class="form-group form-group-half">
          <label for="documentTypeId" class="form-label">Tipo de documento</label>
          <select
            id="documentTypeId"
            formControlName="documentTypeId"
            class="form-input"
            [class.error]="getFieldError('documentTypeId')"
          >
            <option value="">Seleccionar tipo</option>
            <option *ngFor="let tipo of tiposDocumento" [value]="tipo.id">
              {{ tipo.nombre }}
            </option>
          </select>
          <div class="error-message" *ngIf="getFieldError('documentTypeId')">
            {{ getFieldError('documentTypeId') }}
          </div>
        </div>

        <div class="form-group form-group-half">
          <label for="document" class="form-label">Número de documento</label>
          <input
            type="text"
            id="document"
            formControlName="document"
            class="form-input"
            [class.error]="getFieldError('document')"
            placeholder="Número de documento"
          >
          <div class="error-message" *ngIf="getFieldError('document')">
            {{ getFieldError('document') }}
          </div>
        </div>
      </div>

      <!-- Fecha de nacimiento -->
      <div class="form-group">
        <label for="dateBorn" class="form-label">Fecha de nacimiento</label>
        <input
          type="date"
          id="dateBorn"
          formControlName="dateBorn"
          class="form-input"
          [class.error]="getFieldError('dateBorn')"
        >
        <div class="error-message" *ngIf="getFieldError('dateBorn')">
          {{ getFieldError('dateBorn') }}
        </div>
      </div>

      <!-- Teléfono -->
      <div class="form-group">
        <label for="phoneNumber" class="form-label">Número de teléfono</label>
        <input
          type="tel"
          id="phoneNumber"
          formControlName="phoneNumber"
          class="form-input"
          [class.error]="getFieldError('phoneNumber')"
          placeholder="Número de teléfono"
        >
        <div class="error-message" *ngIf="getFieldError('phoneNumber')">
          {{ getFieldError('phoneNumber') }}
        </div>
      </div>

      <!-- EPS -->
      <div class="form-group">
        <label for="epsId" class="form-label">EPS</label>
        <select
          id="epsId"
          formControlName="epsId"
          class="form-input"
          [class.error]="getFieldError('epsId')"
        >
          <option value="">Seleccionar EPS</option>
          <option *ngFor="let eps of epsOptions" [value]="eps.id">
            {{ eps.nombre }}
          </option>
        </select>
        <div class="error-message" *ngIf="getFieldError('epsId')">
          {{ getFieldError('epsId') }}
        </div>
      </div>

      <!-- Género -->
      <div class="form-group">
        <label class="form-label">Género</label>
        <div class="checkbox-container">
          <div class="checkbox-item">
            <label class="checkbox-label">
              <input
                type="radio"
                name="gender"
                value="Masculino"
                formControlName="gender"
                class="checkbox-input"
              >
              <span class="checkbox-text">Masculino</span>
            </label>
          </div>
          <div class="checkbox-item">
            <label class="checkbox-label">
              <input
                type="radio"
                name="gender"
                value="Femenino"
                formControlName="gender"
                class="checkbox-input"
              >
              <span class="checkbox-text">Femenino</span>
            </label>
          </div>
        </div>
        <div class="error-message" *ngIf="getFieldError('gender')">
          {{ getFieldError('gender') }}
        </div>
      </div>

      <!-- Régimen de salud -->
      <div class="form-group">
        <label class="form-label">Régimen de salud</label>
        <div class="checkbox-container">
          <div class="checkbox-item">
            <label class="checkbox-label">
              <input
                type="radio"
                name="healthRegime"
                value="Contributivo"
                formControlName="healthRegime"
                class="checkbox-input"
              >
              <span class="checkbox-text">Contributivo</span>
            </label>
          </div>
          <div class="checkbox-item">
            <label class="checkbox-label">
              <input
                type="radio"
                name="healthRegime"
                value="Subsidiado"
                formControlName="healthRegime"
                class="checkbox-input"
              >
              <span class="checkbox-text">Subsidiado</span>
            </label>
          </div>
        </div>
        <div class="error-message" *ngIf="getFieldError('healthRegime')">
          {{ getFieldError('healthRegime') }}
        </div>
      </div>

      <!-- Botón siguiente -->
      <button
        type="submit"
        class="register-button"
        [disabled]="personaForm.invalid || isCreatingPersona"
      >
        {{ isCreatingPersona ? 'Creando persona...' : 'Siguiente' }}
      </button>
    </form>

    <!-- Paso 2: Formulario de Usuario -->
    <form *ngIf="currentStep === 2" [formGroup]="usuarioForm" (ngSubmit)="onSubmitUsuario()" class="role-form">
      
      <!-- Información de la persona creada -->
      <div class="person-info" *ngIf="personaCreada">
        <h3>Persona registrada:</h3>
        <p><strong>{{ personaCreada.fullName }} {{ personaCreada.fullLastName }}</strong></p>
        <p>Documento: {{ personaCreada.document }}</p>
      </div>

      <!-- Email -->
      <div class="form-group">
        <label for="email" class="form-label">Correo electrónico</label>
        <input
          type="email"
          id="email"
          formControlName="email"
          class="form-input"
          [class.error]="getFieldError('email')"
          placeholder="correo@ejemplo.com"
        >
        <div class="error-message" *ngIf="getFieldError('email')">
          {{ getFieldError('email') }}
        </div>
      </div>

      <!-- Contraseña -->
      <div class="form-group">
        <label for="password" class="form-label">Contraseña</label>
        <input
          type="password"
          id="password"
          formControlName="password"
          class="form-input"
          [class.error]="getFieldError('password')"
          placeholder="Contraseña"
        >
        <div class="error-message" *ngIf="getFieldError('password')">
          {{ getFieldError('password') }}
        </div>
      </div>

      <!-- Estado activo -->
      <div class="form-group">
        <div class="checkbox-item">
          <label class="checkbox-label">
            <input
              type="checkbox"
              formControlName="active"
              class="checkbox-input"
            >
            <span class="checkbox-text">Usuario activo</span>
          </label>
        </div>
      </div>

      <!-- Botones -->
      <div class="button-row">
        <button
          type="button"
          class="back-button"
          (click)="goBack()"
        >
          Atrás
        </button>
        <button
          type="submit"
          class="register-button"
          [disabled]="usuarioForm.invalid || isCreatingUsuario"
        >
          {{ isCreatingUsuario ? 'Creando usuario...' : 'Crear Usuario' }}
        </button>
      </div>
    </form>
  </div>
</div>