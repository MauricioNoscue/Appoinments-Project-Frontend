<h1>persona relacionada </h1>

<div class="cards-grid">
  <!-- Tarjetas de personas -->
  <mat-card
    class="person-card"
    *ngFor="let p of people()"
    (click)="select(p)"
    [class.selected]="selectedId() === p.id"
    tabindex="0"
    [attr.aria-pressed]="selectedId() === p.id"
    [attr.aria-label]="'Seleccionar a ' + p.name + ' ' + p.lastname">

    <div class="top">
      <div class="avatar" [style.background]="p.color">
        {{ initials(p) }}
      </div>

      <div class="text-block">
        <div class="name">{{ p.name }}</div>
        <div class="lastname">{{ p.lastname }}</div>
        <mat-chip class="relation-chip" selected>{{ p.relation }}</mat-chip>
      </div>

      <button
        mat-icon-button
        class="menu-btn"
        (click)="$event.stopPropagation()"
        [matMenuTriggerFor]="menu"
        aria-label="Más opciones">
        <mat-icon>more_vert</mat-icon>
      </button>
    </div>

    <mat-menu #menu="matMenu" xPosition="before">
      <button mat-menu-item (click)="view(p)">
        <mat-icon>visibility</mat-icon>
        <span>Ver</span>
      </button>
      <button mat-menu-item (click)="edit(p)">
        <mat-icon>edit</mat-icon>
        <span>Editar</span>
      </button>
      <button mat-menu-item (click)="remove(p)">
        <mat-icon>delete</mat-icon>
        <span>Eliminar</span>
      </button>
    </mat-menu>
  </mat-card>

  <!-- Tarjeta para agregar -->
  <button class="add-card" (click)="addPerson()" aria-label="Agregar persona">
    <div class="add-dashed">
      <div class="plus">+</div>
      <div class="add-text">Agrega Persona</div>
    </div>
  </button>
</div>

<!-- =========================
     MODAL: DETALLES (sin otro componente)
========================= -->
<!-- HTML del Modal Mejorado -->
<ng-template #detailDialog let-data>
  <div class="modal-container">
    <!-- Header del Modal -->
    <div class="modal-header">
      <h2 class="modal-title">Detalles de Persona</h2>
      <button
        mat-icon-button
        class="close-btn"
        mat-dialog-close
        aria-label="Cerrar modal">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <!-- Contenido Principal -->
    <div class="modal-content">
      <!-- Avatar y Información Principal -->
      <div class="person-info">
        <div class="avatar-container">
          <div class="person-avatar" [style.background]="data.color || '#4f46e5'">
            {{ (data.name + ' ' + data.lastname).split(' ')[0][0] + (data.lastname?.split(' ')[0]?.[0] || '') | uppercase }}
          </div>
        </div>

        <div class="person-details">
          <h3 class="person-name">{{ data.name }} {{ data.lastname }}</h3>
          <p class="person-subtitle">{{ data.lastname }}</p>
        </div>
      </div>

      <!-- Información Detallada -->
      <div class="details-section">
        <div class="detail-item">
          <div class="detail-icon">
            <mat-icon>badge</mat-icon>
          </div>
          <div class="detail-content">
            <span class="detail-label">Identificación</span>
            <span class="detail-value">{{ data.idNumero || '—' }}</span>
          </div>
        </div>

        <div class="detail-item">
          <div class="detail-icon">
            <mat-icon>diversity_3</mat-icon>
          </div>
          <div class="detail-content">
            <span class="detail-label">Relación</span>
            <span class="detail-value">{{ data.relation }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer con Botón -->
    <div class="modal-footer">
      <button
        mat-flat-button
        color="primary"
        class="close-button"
        mat-dialog-close>
        Cerrar
      </button>
    </div>
  </div>
</ng-template>
